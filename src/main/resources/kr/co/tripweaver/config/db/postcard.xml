<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="postcardSQL">
	
	<select id="selectPostCardAll" parameterType="Map" resultType="postcardVo">
		SELECT * FROM
		(SELECT rownum rnum, list2.* FROM (
		select 
		p. *
		, m.mem_nick
		, m.mem_profile
		from POSTCARD p INNER JOIN member m
		on (p.mem_id = m.mem_id and p.PC_DEL = 'N') 
		
		<if test="tag_search != '' ">
		inner join 
		(
		SELECT
		    distinct PC_ID
		FROM HASHTAG 
		WHERE TAG_WORD like '%' ||  #{tag_search} || '%'
		) has
		on (has.PC_ID = p.PC_ID )
		</if>
		
		ORDER by p.pc_date desc
		)list2)
		where rnum = ${pageVo.page}
		and pc_del = 'N'
	
	</select>
	
	<!-- 포스트카드 삭제하기 -->
	<update id="deletePostcard"  parameterType="postcardVo">
		UPDATE postcard
		set PC_DEL = 'Y'
		where PC_ID = #{pc_id}
		and MEM_ID = #{mem_id}
	</update>
	
	<!-- 포스트 카드 글쓰기 -->
	<insert id="insertPostcard" parameterType="postcardVo">
		<selectKey resultType="String" keyProperty="pc_id" order="BEFORE" >
  			SELECT	'pc'||lpad(pc_seq.nextval, 5, 0) from dual
  		</selectKey>
		insert into postcard (
		    pc_id
		    , pc_cnt
		    , pc_date
		    , pc_like_count
		    , pc_del
		    , mem_id
		)
		values (
		      #{pc_id}
		    , #{pc_cnt}
		    , sysdate
		    , 0
		    , 'N'
		    , #{mem_id}
		)
	</insert>
	
	<!-- 포스트카드 업데이트 -->
	<update id="updatePostcard" parameterType="postcardVo">
		UPDATE postcard
		set pc_cnt = #{pc_cnt}
		where PC_ID = #{pc_id}
	</update>
	
	<!-- 포스트카드 해당 게시글 내용 잡아오기 -->
	<select id="selectPostcard" parameterType="String" resultType="postcardVo">
		SELECT
		    *
		FROM postcard
		where PC_ID = #{pc_id}
	</select>
	
	
</mapper>